@startuml REMEZ_Component_Diagram

title REMEZ System - Component Diagram

!theme plain
skinparam monochrome false
skinparam defaultFontName Arial
skinparam roundcorner 3
skinparam shadowing false

' High resolution for clarity
skinparam dpi 400
skinparam padding 3
skinparam nodesep 50
skinparam ranksep 60
skinparam componentStyle rectangle

' Clear readable fonts
skinparam defaultFontSize 20

skinparam component {
    BackgroundColor #F8F8FF
    BorderColor #000000
    FontSize 20
}

skinparam node {
    BackgroundColor #E8DAFF
    BorderColor #000000
    FontSize 20
}

skinparam database {
    BackgroundColor #E0CFFC
    BorderColor #000000
    FontSize 20
}

skinparam cloud {
    BackgroundColor #C9CDFF
    BorderColor #000000
    FontSize 20
}

skinparam package {
    FontSize 20
}

' ==========================================
' Layer 1: External Services (Top)
' ==========================================
cloud "External Services" as External {
    component Google_OAuth
    component SMTP_Server
    component FAERS_Source
}

note top of External
    **External Services**
    Google OAuth • SMTP • FAERS
end note

' ==========================================
' Layer 2: Frontend (Second)
' ==========================================
node "Frontend Server :3000" as FrontendNode {
    package React_App {
        component Auth_Pages
        component Query_Form
        component Results_Viewer
        component ROR_Chart
    }
    
    package Services {
        component HTTP_Client
        component Token_Service
    }
}

note right of FrontendNode
    **Frontend - React**
    Chart.js • JWT • Axios
end note

' ==========================================
' Layer 3: Backend (Middle)
' ==========================================
node "Backend Server :8000" as BackendNode {
    package Django_App {
        package API_Layer {
            component Auth_API
            component Query_API
            component Result_API
        }
        
        package Services_Layer {
            component Pipeline_Service
            component Email_Service
            component JWT_Handler
        }
    }
    
    component Django_ORM
}

note right of BackendNode
    **Backend - Django**
    PostgreSQL • OAuth • Email
end note

' ==========================================
' Layer 4: Pipeline (Fourth)
' ==========================================
node "Pipeline Server :8001" as PipelineNode {
    package FastAPI_App {
        package API_Endpoints {
            component Run_Endpoint
            component Status_Endpoint
        }
        
        package Task_Mgmt {
            component Task_Repository
            component Process_Pool
        }
        
        package Data_Process {
            component FAERS_Loader
            component Data_Marker
            component Report_Generator
            component ROR_Calculator
        }
    }
}

note right of PipelineNode
    **Pipeline - FastAPI**
    Async • Process Pool • ROR
end note

' ==========================================
' Layer 5: Data Stores (Bottom)
' ==========================================
database "PostgreSQL\n(Supabase)" as Postgres
database "SQLite" as SQLite
folder "File System" as FileSystem

note bottom of Postgres
    **Database Models**
    User • Query • Result
end note

' ==========================================
' Vertical Connections - Top to Bottom
' ==========================================
External -down-> FrontendNode : OAuth/SMTP
FrontendNode -down-> BackendNode : HTTP+REST
BackendNode -down-> PipelineNode : POST
PipelineNode -down-> SQLite : Store
PipelineNode -down-> FileSystem : Files
BackendNode -down-> Postgres : SQL
PipelineNode -up-> BackendNode : PUT\nCallback
FAERS_Source -down-> FileSystem : Download

' ==========================================
' Horizontal Connections
' ==========================================
BackendNode -up-> Google_OAuth : OAuth
BackendNode -up-> SMTP_Server : Email

legend bottom right
|= Symbol |= Meaning |
| node | Server |
| component | Module |
| database | Storage |
| cloud | External |
endlegend

hide footbox
scale 700 width

@enduml